<div class="spinner" *ngIf="isLoading">
  <mat-spinner ></mat-spinner>
</div>

<body>
  
<div class="entire-page" *ngIf="!isLoading">
  
  <!-- Entire page -->
  <div class="main-layout" >

    <div class="left-column">


      <div class="center"> New To Skalarly</div>
      <!-- <mat-divider></mat-divider> -->
      <!-- Reccomendations and adds -->
      <!-- Limit load in amount at a time -->
      <div class= "recents"  >
        <!-- Then each card is filled uniquely passed off {{ }}  values in feed-->
        <app-card-recommendation    >
        </app-card-recommendation>
      </div>


    

    </div>

    <!-- middle -->
    <div class="middle-column-large">
      <div class="center_">
        <div class="label">What are you looking for?</div>
      </div>
      <!-- Category box -->
      <div class="input-boxs">
        <div class="center_single">Step 1: Choose from the main categories</div>

        <!-- <mat-chip-list aria-label="First Choice"> -->
          <mat-form-field>
          <mat-select [selected]="opt.name" 
           class="center_step1" >
            <mat-option class="horizontal_list" *ngFor="let opt of searchOptions" [value]="opt.name"
            (click)="onSearchSelection(opt.value)" (click)="displaySpecificSearch()" >
              {{ opt.name }}</mat-option>
          </mat-select>
        </mat-form-field>
        <!-- </mat-chip-list> -->



        <div class="input-boxs_" *ngIf="opt >= 1">
          <div class="center_single">Step 2: Navigate to the specific page</div>
          <mat-chip-list class="mat-list-text">
            <mat-chip [multiple]="false" *ngFor="let opt of specificOptions" [value]="opt" (click)="navigateToPage(opt)">
              {{ opt }}
            </mat-chip>
          </mat-chip-list>
        </div>
      </div>
    </div>
    <!-- right -->
    <div class="right-column">
      <!-- Recents tetx -->
      <div class="center" >
        Recent Feed
      </div>
      <div class="column_" *ngIf="posts.length == 0">
        <div class="row"> No Posts At The Moment</div>
        <!-- <i class="far fa-frown centerR"></i> -->

        <div class="fill_">
    <mat-chip-list >
          <mat-chip color="primary" selected class="centerR" (click)="navigateToPost()">Post Now</mat-chip>
          </mat-chip-list>
        </div>
        <!-- <div class="row"> Or try refreshing the page</div> -->

      </div>

<!-- [ngForOf]="posts" -->
      <div class="recents" *ngIf="posts.length !== 0" >


<!-- *ngIf="(userIsAuthenticated && (userId === posts.Creator))" -->

<app-card-feed  class="hideFeed" >
</app-card-feed>

      </div>
    </div>
  
       </div>

</div>
<script>
   // Register service worker
   window.addEventListener('load', () => {
      if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/worker.js')
      .then((registration) => {
        console.log('Service worker registered!');
      })}
    })


// Web-Push
// Public base64 to Uint
function urlBase64ToUint8Array(base64String) {
    var padding = '='.repeat((4 - base64String.length % 4) % 4);
    var base64 = (base64String + padding)
        .replace(/\-/g, '+')
        .replace(/_/g, '/');

    var rawData = window.atob(base64);
    var outputArray = new Uint8Array(rawData.length);

    for (var i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
    }
    return outputArray;
}


function configurePushSub(){
  if (!('serviceWorker' in navigator)) {
    return}
    var req
  navigator.serviceWorker.ready
  .then((swreq) => {
    req = swreq
    console.log('hey chazzy', swreq);
    return swreq.pushManager.getSubscription()
})
.then(sub => {
  if (sub === null){
// Create a new subscription
var convertedVapidPublicKey = urlBase64ToUint8Array('BDNe3_EmHJwCDbzfy6BgJbboqVWt2yjqCbdKCfsao7LQ9clrK8383DMRtX5_RJI-99aqPq5N2pRBRRDMvcuWsBs');
req.pushManager.subscribe({
  userVisibleOnly: true,
  applicationServerKey: convertedVapidPublicKey
}).then(newSub => {
  return fetch('https://www.skalarly.com/api/subscribe/follow', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(newSub),
  })
})
.then(res => {
  if(res.ok){
  displayConfirmNotification()
  }

})
  }else{
// We have a subscription

  }
})
.catch(err => {
  console.log(err)
})
}

// displayConfir notif
function displayConfirmNotification(){
  if('serviceWorker' in navigator) {
    navigator.serviceWorker.ready
    .then(swreq => {
      swreq.showNotification('Successfully subscribed dawg!')
    })
  }
}


    // Get notifcation permission
    function askForNotificationPermission(){
    Notification.requestPermission(function(result){
      console.log('Permission', result);
      if (result !== 'granted'){
      console.log('Permission not granted');
      }
      else{
        configurePushSub();
      }
    })
  }

    if('Notification' in window){
window.addEventListener('load', askForNotificationPermission);
  }
</script>
</body>


    <!-- Mobile -->
    <!-- <div class="hide1">
      <div class="topM">
        <div class="center"> Recommendations</div>
        <!-- ADDDDDDSSSSSS!!--

        <div class="logo-layoutM">
          <!-- Adds and recommecndations will be mixed into feed!!!!! --
          <div class="fit">
            <!-- If user does not make in friend list --
            <app-card-recommendation class="hide" [ngForOf]="profiles">

            </app-card-recommendation>
          </div>
        </div>


        <div class="column">
          <div class="center_">
            <div class="label">What are you looking for?</div>
          </div>
          <mat-selection-list #options [multiple]="false" class="second-list">
            <mat-form-field appearance="fill">
              <mat-label> Step 1: Choose from the main categories</mat-label>

              <mat-select [formControl]="postLocationMain">
                <mat-option (click)="onSearchSelection(opt.value)" [selected]="opt.name" [multiple]="false"
                  *ngFor="let opt of searchOptions" [value]="opt.name">

                  {{ opt.name }}</mat-option>
              </mat-select>

            </mat-form-field>
          </mat-selection-list>

          <!-- Second choice --
          <div class="location-options">
            <mat-selection-list class="mat-list-text" *ngIf="postLocationMain.value">
              <mat-form-field appearance="fill">
              <mat-label> Step 2: Navigate to the specific page</mat-label>

              <mat-select>
              <mat-option [multiple]="false" *ngFor="let opt of specificOptions" [value]="opt"
                (click)="navigateToPage(opt)">

                {{ opt }}
</mat-option>
</mat-select>
</mat-form-field>
            </mat-selection-list>
          </div>


        </div>
        <div class="center" *ngIf="posts.length !== 0">
          Recent Feed
        </div>
        <div class="recents" *ngIf="posts.length == 0">
          <div class="fill">
            <div class="label_">Post Now</div>
            <!-- <div class="centerR"> <i class="far fa-grin-alt"></i></div> --
            <div class="icon-btn-fit post ">
              <button mat-fab type="button" routerLink="/post-page" color="primary">
                <mat-icon-button >add_circle</mat-icon-button>
              </button>
            </div>

          </div>
        </div>
        <div class="recents" *ngIf="posts.length !== 0" >
          <app-card class="display" [ngForOf]="posts">
           
          </app-card>
        </div>
       
      </div>
    </div>
  </div>
</div> -->