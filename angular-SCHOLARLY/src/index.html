<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="icon" type="image/x-icon" href="/angular-SCHOLARLY/src/faviconH.ico">
  <title>Skalarly</title>
  <base href="/">
  
  <script src="https://kit.fontawesome.com/3b5f3d4144.js" crossorigin="anonymous" ></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">


  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel&family=Poppins:wght@200&display=swap" rel="stylesheet">


</head>
<body class="mat-typography igx-typography">
  <app-root>
    <!-- <script src="/socket.io/socket.io.js"></script> -->
  <script src="https://cdn.socket.io/4.5.0/socket.io.min.js" integrity="sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k" crossorigin="anonymous"></script>
 
    <script>
      var socket = io.connect();
      // Register service worker
      window.addEventListener('load', () => {
      if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/worker.js')
      .then((registration) => {
        console.log('Service worker registered!');
        // console.log(
        //   'Hooray. Registration successful, scope is:',
        //   registration.scope
        // );
      })}
    })


// Web-Push
// Public base64 to Uint
function urlBase64ToUint8Array(base64String) {
    var padding = '='.repeat((4 - base64String.length % 4) % 4);
    var base64 = (base64String + padding)
        .replace(/\-/g, '+')
        .replace(/_/g, '/');

    var rawData = window.atob(base64);
    var outputArray = new Uint8Array(rawData.length);

    for (var i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
    }
    return outputArray;
}


function configurePushSub(){
  if(!('serviceWorker' in navigator)){
return;
  }
  navigator.serviceWorker.ready
  .then((subscription) => {
    console.log('hey chazzy', subscription)
      const options = subscription.options;
    console.log('peanuts', options.applicationServerKey);
    req.pushManager.subscribe({userVisibleOnly: true,
      applicationServerKey: urlBase64ToUint8Array(
          'BDNe3_EmHJwCDbzfy6BgJbboqVWt2yjqCbdKCfsao7LQ9clrK8383DMRtX5_RJI-99aqPq5N2pRBRRDMvcuWsBs'),
      })
        .then((pushSubscription) => {
        console.log('cookie', pushSubscription.endpoint)
        return fetch('https://www.skalarly.com/api/subscribe/follow', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(pushSubscription.endpoint),
  })
    })
  


    .then(sub => {
      console.log('hey chaz', sub)
   
    })
//     const subscribeOptions = {
//         userVisibleOnly: true,
//         applicationServerKey: urlBase64ToUint8Array(
//           'BDNe3_EmHJwCDbzfy6BgJbboqVWt2yjqCbdKCfsao7LQ9clrK8383DMRtX5_RJI-99aqPq5N2pRBRRDMvcuWsBs'
//         ),
//       };
//  req.pushManager.subscribe(subscribeOptions)

    // sendSubscriptionToBackEnd(subscription)
})
}

// function sendSubscriptionToBackEnd(subscription) {
//   console.log('route half way', subscription.endpoint);

//   return fetch('https://www.skalarly.com/api/subscribe/follow', {
//     method: 'POST',
//     headers: {
//       'Content-Type': 'application/json',
//     },
//     body: JSON.stringify(subscription),
//   })
// }

    // Get notifcation permission
    function askForNotificationPermission(){
    Notification.requestPermission(function(result){
      console.log('Permission', result);
      if (result !== 'granted'){
      console.log('Permission not granted');
      }
      else{
        configurePushSub();
        // displayConfirmNotification()
      }
    })
  }

    if('Notification' in window){
window.addEventListener('load', askForNotificationPermission);
  }
    </script>


  </app-root>
</body>
</html>
